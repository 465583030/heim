# The psql container runs the postgres server from the psqldata/data directory.
psql:
  build: containers/psql
  volumes:
    - psqldata/data:/var/lib/postgresql/data

# The psqlclient container provides a client connection to the psql container.
# TODO: add volume for persistent readline history, sql dumps, etc.
psqlclient:
  command: psql -h psql -p 5432 -U postgres heim
  build: containers/psql/client
  links:
    - psql

# The frontend container runs an ongoing gulp build.
frontend:
  command: gulp build
  build: client
  volumes:
    - client:/srv/heim/client/src
    - client/build:/srv/heim/client/src/build
  environment:
    NODE_ENV: production

# The upgradedb container runs the upgradedb command against the psql container.
upgradedb:
  build: backend/upgradedb
  links:
    - psql
  volumes:
    - .:/go/src/heim

# The backend container runs the backend server against the psql container.
backend:
  build: backend
  links:
    - psql
  volumes:
    - .:/go/src/heim
    - client/build:/srv/heim/client/src/build
  ports:
    - "8080:80"
    - "2222:22"
